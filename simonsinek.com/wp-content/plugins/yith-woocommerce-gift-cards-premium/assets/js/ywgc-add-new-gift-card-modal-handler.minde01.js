!function(d){var t;function o(t,o,a){t.show().addClass("animated "+o),t.one("animationend",function(){t.removeClass("animated "+o),void 0!==a&&a()})}"undefined"!=typeof ywgc_add_new_gift_card_data&&((t=function(t){t.length&&(this.self=t,this.wrap=t.find(".yith-ywgc-add-new-gift-card-modal-wrapper"),this.popup=t.find(".yith-ywgc-add-new-gift-card-modal"),this.content=t.find(".yith-ywgc-add-new-gift-card-modal-content-wrapper"),this.overlay=t.find(".yith-ywgc-add-new-gift-card-modal-overlay"),this.blocked=!1,this.opened=!1,this.additional=!1,this.animationIn=this.popup.attr("data-animation-in"),this.position(null),d(this.popup).on("click",function(t){t.stopPropagation()}),d(window).on("resize",{obj:this},this.position),d(document).on("click","#ywgc-add-new-gift-card",{obj:this,additional:!1},this.open),d(document).on("click",".yith-ywgc-add-new-gift-card-modal-overlay.close-on-click",function(t){t.preventDefault(),d(".yith-ywgc-add-new-gift-card-modal-wrapper .yith-ywgc-add-new-gift-card-modal-close").click()}),this.popup.on("click",".yith-ywgc-add-new-gift-card-modal-close",{obj:this},this.close))}).prototype.position=function(t){var t=(null==t?this:t.data.obj).popup,o=d(window).width(),a=d(window).height(),a=o-40>ywgc_add_new_gift_card_data.popupWidth?a/10+"px":"0",o=o-40>ywgc_add_new_gift_card_data.popupWidth?ywgc_add_new_gift_card_data.popupWidth+"px":"auto";t.css({"margin-top":a,"margin-bottom":a,width:o})},t.prototype.block=function(){this.blocked||(this.popup.block({message:null,overlayCSS:{background:"#fff url("+ywgc_add_new_gift_card_data.loader+") no-repeat center",opacity:.5,cursor:"none"}}),this.blocked=!0)},t.prototype.unblock=function(){this.blocked&&(this.popup.unblock(),this.blocked=!1)},t.prototype.open=function(t){t.preventDefault();t=t.data.obj;t.opened||(t.opened=!0,t.loadTemplate("add-new-gift-card-template",{title:""}),t.self.fadeIn("slow"),o(t.overlay,"fadeIn"),o(t.popup,t.animationIn),d("html, body").addClass("yith-ywgc-add-new-gift-card-modal-opened"),t.wrap.css("position","fixed"),t.overlay.css("position","fixed"),t.overlay.css("z-index","1"),t.wrap.find("#ywgc-link-code").focus(),d(document).trigger("yith_ywgc_add_new_gift_card_modal_opened",[t.popup,t]),d(".ywgc-link-gift-card-submit-button").on("click",function(){var o=d(".ywgc-add-new-gift-card-form"),t={gift_card_code:d("#ywgc-link-code").val(),user_id:d(this).data("current-user-id"),action:"ywgc_add_new_gift_card_my_account"};o.block({message:null,overlayCSS:{background:"#f1f1f1",opacity:.5}}),d.ajax({type:"POST",url:ywgc_add_new_gift_card_data.ajax_url,data:t,dataType:"json",success:function(t){t.success?(d(".yith-add-new-gc-my-account-notice-message.not_valid").hide(),d(".yith-add-new-gc-my-account-notice-message.valid").show(),setTimeout(function(){d(".yith-ywgc-add-new-gift-card-modal-wrapper .yith-ywgc-add-new-gift-card-modal-close").click(),location.reload()},3e3)):d(".yith-add-new-gc-my-account-notice-message.not_valid").show(),o.unblock()},error:function(t){return o.unblock(),!1}})}))},t.prototype.loadTemplate=function(t,o){t=wp.template(t);this.showTemplate(t(o))},t.prototype.showTemplate=function(t){this.content.hide().html(t).fadeIn("slow"),d(document).trigger("yith_ywgc_add_new_gift_card_modal_template_loaded",[this.popup,this])},t.prototype.close=function(t){t.preventDefault();t=t.data.obj;t.additional=!1,t.opened=!1,t.self.fadeOut("slow"),d("html, body").removeClass("yith-ywgc-add-new-gift-card-modal-opened"),d(document).trigger("yith_ywgc_add_new_gift_card_modal_template_closed",[t.popup,t])},d(function(){new t(d(document).find("#yith-ywgc-add-new-gift-card-modal-container"))}))}(jQuery);